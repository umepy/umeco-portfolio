---
title: "CPUを2700Xから5900Xに変えた話"
date: "20230419"
tags: ["日記"]
---
# CPUを2700Xから5900Xに変えた話

## 背景

以前にメインPCを組んだのは7年前ぐらいで、そろそろ色々変えようかなと思っていました。一番変えたかったのはグラボなんですが、RTX4090は大体35万円するのでなかなか食指が動かず。
そしてグラボを変えるなら絶対にCPUがボトルネックになるので変える必要があるのですが、最新のRyzen7900Xなどはソケットが丁度AM5に切り替わってしまったそうです。
つまり、CPUを変える場合はIntel/Ryzen問わずマザーボードから更新となり、メモリはDDR5なので再度購入する必要があるという。。結局全部１から構築する必要があり、その場合は70万近くの出費。。  
今のGPUは1080で重いゲームじゃなければ問題なく動作するので、それならAM4ソケットのCPUだけ更新しておこうと思いました。

[GeForce RTX 5000シリーズ、前世代から2倍以上性能向上か。Blackwellアーキテクチャの概要がリーク](https://www.nichepcgamer.com/archives/nvidia-geforce-rtx-5000-seires-blackwell-architecture-early-leak-information-april-2023.html)  
↑いやこんな記事出されたらRTX5000番台に期待してしまうて...

## 購入前スペック

OS: Win10  
MB: ASRock X470 Taichi  
CPU: Ryzen 2700X  
GPU: GTX 1080  

## 購入

そこでAM4ソケットで一番良さそうなCPUを買おうと思ったのですが、時期がかなり良い。初値7万↑だった5900Xや5800X3Dが4.5万ぐらいまで落ちていました。
本当は一番良いCPUである5950Xを買いたかったのですが、値段がほとんど下がっていないのでこちらは諦め[5900X](https://amzn.to/3UsJWHL)を購入。

合わせてコスパの良いCPUクーラーとしておすすめされていた[DeepCool AK620](https://amzn.to/3zOOjU8)も購入。今までは2700XのリテールクーラーであるWraith Prismを使っていました。
（あんまり冷えないといわれてましたが、発光も綺麗で個人的にはかなり好きでした。ありがとうAMD。）

そしてグリスには定番の[熊グリス](https://amzn.to/3MQFXmX)を購入。これで準備は完璧。  
だと思っていました。。。

## UEFI更新

まずX470の古いマザーボードなのでUEFIを更新しないと5900Xは動きません。なので最初にUEFIの更新をするのですが、これはとても簡単でした。
単純にUSBメモリにASRock公式ページで配布されているファームウェアをダウンロードしてUSBメモリへコピーするだけ。後はUEFI起動後ファームウェアを選択するだけでアップデート完了。

おっ余裕じゃん！という感じ。

## 取付

CPU交換の時に最も怖いのはスッポンと呼ばれるCPUクーラーの取り外しの時にCPUごと取り外してしまう行為です。これはCPUグリスが固まってしまうことが原因なので、この確率を下げるためにCinebenchを20分回してCPUグリスを出来るだけ柔らかくしました。温度を測ったら82度ぐらいでした。

その後、早速CPUクーラーを取り外していくのですが、まさかのWraith Prismの固定用のプラスチックのバーが緩めた瞬間に爆発四散！　ポンッ！と音がしたのでちょっと驚きましたが、もう使わんしええかと気を強く持ちました。その後、ぐりぐりスッポンしないように外そうとしますが...

スポッ！

はい、スッポンしました。温めた意味もありませんでした。まぁ5年ぐらい全くメンテしてないのでグリスは完全に固まってるだろうなと予想はしてたので特にショックはありません。ただし、CPUピンは1本曲がってました・・・。ま、まあ曲がってるだけなら真っ直ぐにすれば動くかな。。

あとはCPUを付けてグリスぬってCPUクーラーを付けました。X字にグリス塗るのは初めて(というか2700Xは元からついていた)なのでちょっと緊張したぐらいですね。

その後起動してみると・・・、普通に起動した！組み上げて始めて起動するときはやっぱりドキドキしました。良かった。

## 問題発生

良くありませんでした。。新しく組み上げてCinebenchを回してみると一瞬でPCが落ちてしまう現象が発生してしまい大慌て。
CPU温度をチェックすると平常時50~60度、ベンチマーク中は80度程度になっていることが分かり、そして温度が80度を越えてある程度上昇すると落ちる、という印象を受けました。CPU温度も評判の良いCPUクーラーを買った割には高いぞ、という感じ。

ここで思ったのが、あれ？CPUクーラーうまく取り付けられないのかなということ。確かにそこに不安が多少ありました。そこで再度グリスを追加注入、たっぷりグリスを食らいやがれ。
再度Cinebenchを回してみるとちょっとCPU温度が下がるようになりましたが、ブルースクリーンが発生するように。エラー内容は**whea_uncorrectable_error**。

ここで一旦ブルースクリーンなのでメモリの問題かなと、安直に思いメモリの周波数や電圧などを色々変えてみることに。しかし症状は全く変わらない。なので次にメモリテストを走らせてみることにしました。
メモリテストはめちゃくちゃ遅くて5%ぐらいで中止しました。というのも何回もPCクラッシュを見てきた中で、この問題はメモリではなくやっぱりCPUの温度だという直観があったからです。というのも、2回目のグリスを塗った後、PCケースのサイドガラスを開けたままCinebenchを回すと、クラッシュまでかなり持ったのに対し、閉じると早めにクラッシュしてしまうからです。

ここで幸運だったのはお手上げ状態ではなく、ブルースクリーン状態でのダンプファイルを調査することが出来たことです。実はグリス1回目の状態ではブルースクリーンを挟むことなく(または一瞬ブルースクリーンが出るが強制クラッシュ)クラッシュしていたので、この状態だとダンプファイルすら生成されていませんでした。

このダンプファイルは`C://Windows/Minidump`に生成されるのですが、このファイルを読むにはWindows SDKのインストールが必要です。やり方は

[ブルースクリーンのメモリダンプから原因を解析する方法](https://shop.applied-net.co.jp/blog/cate_kojin_news_tech/21926/)を参考にしました。

ダンプファイルの分析結果は以下のような結果
```
MODULE_NAME: AuthenticAMD
IMAGE_NAME:  AuthenticAMD.sys
STACK_COMMAND:  .cxr; .ecxr ; kb
FAILURE_BUCKET_ID:  0x124_0_AuthenticAMD_PROCESSOR__UNKNOWN_IMAGE_AuthenticAMD.sys
OS_VERSION:  10.0.19041.1
BUILDLAB_STR:  vb_release
OSPLATFORM_TYPE:  x64
OSNAME:  Windows 10
FAILURE_ID_HASH:  {035dcc87-485b-74b3-1c1b-ee50cb0c2865}
Followup:     MachineOwner
```

しかし、この内容からは何が原因かは分かりませんでした。しかし、この情報をもとにネットを検索すると・・、ついに神情報へとたどり着きます。

[FF14ブルースクリーン問題　やっと解決しました](https://jp.finalfantasyxiv.com/lodestone/character/1344652/blog/5102117/)

↑は5800Xを使っていてブルースクリーンに悩まされている方の解決方法でした。この方と共通だったのはマザーボードがASRockだったこと。
ここに書いてあるようにRyzenの**Core Performance Boost(CPB)**が悪さをしていました。CPBは自動OC機能みたいで、そりゃ温度上がるよねという。

>温度が上がることはRYZENのCPB仕様だから問題ないんだけど、冷却機構の簡易水冷FANまたはポンプのPID制御がかみ合っておらず、強制再起動おきるCPU温度まで上がってるんじゃないかなと。それがBSODとして表面に出てきてるんじゃないかと仮説

記事を作ってくれた方の仮説はたぶん正しい。普通の人は問題なくCPB使えてるのかな？デフォルト設定でこれがONなの地雷ですよね。
ネット上の誰かが残してくれた備忘録、本当に助かりました。

## 解決方法

RyzenのCPBを切ればOKです。具体的にはUEFIを起動して、 `Advanced/CPU Configuration/AMD CBS/Core Performance Boost` をDisabledにする。
これでCinebenchは問題なくパス。以下がOn/Offの差です

||CPB|CPB off|
|---|---|---|
|Clock|4.0GHz|3.6GHz|
|Normal Temp.|60℃|40℃|
|Highest Temp.|80℃|60℃|

このようにCPUの温度の差は歴然でした。
